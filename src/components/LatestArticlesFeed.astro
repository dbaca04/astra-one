---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "./FormattedDate.astro";
import { Picture } from "astro:assets";

interface Props {
    posts: CollectionEntry<"blog">[];
    title?: string;
    showImages?: boolean;
    limit?: number;
}

const {
    posts,
    title = "Latest Articles",
    showImages = true,
    limit = 3,
} = Astro.props;

// Limit the number of posts to display
const limitedPosts = posts.slice(0, limit);
---

<div class="my-8 p-4 bg-theme-card-bg rounded-lg border border-theme-border">
    {
        title && (
            <h3 class="text-xl font-semibold mb-4 text-theme-text">{title}</h3>
        )
    }

    {
        limitedPosts.length > 0 ? (
            <ul class="list-none p-0 my-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {limitedPosts.map((post) => {
                    const postSlug = post.data.slug || post.id;
                    const imageSource = post.data.heroImage || post.data.image;

                    return (
                        <li class="rounded-lg overflow-hidden transition-all duration-200 ease-in-out hover:shadow-lg hover:-translate-y-1 bg-theme-card-bg flex flex-col">
                            <a
                                href={`/blog/${postSlug}/`}
                                class="no-underline text-inherit flex flex-col sm:flex-row h-full group"
                            >
                                {showImages && imageSource && (
                                    <div class="overflow-hidden sm:w-1/3 sm:flex-shrink-0 relative">
                                        <Picture
                                            src={imageSource}
                                            alt={post.data.title}
                                            width={400}
                                            height={225}
                                            formats={["avif", "webp", "jpeg"]}
                                            quality={75}
                                            sizes="(max-width: 639px) 100vw, (max-width: 1023px) 50vw, 33vw"
                                            fit="cover"
                                            position="center"
                                            class="w-full h-48 sm:h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                        />
                                    </div>
                                )}
                                <div class="p-4 flex-grow flex flex-col justify-between">
                                    <div>
                                        <h4 class="mb-2 text-lg font-semibold text-theme-text leading-tight group-hover:text-theme-accent transition-colors">
                                            {post.data.title}
                                        </h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">
                                            <FormattedDate
                                                date={post.data.date}
                                            />
                                        </p>
                                        {post.data.description && (
                                            <p class="text-sm leading-relaxed text-gray-600 dark:text-gray-300 article-description">
                                                {" "}
                                                {/* Keep for line clamp */}
                                                {post.data.description}
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </a>
                        </li>
                    );
                })}
            </ul>
        ) : (
            <p class="text-center italic p-4 text-gray-500 dark:text-gray-400">
                No articles found.
            </p>
        )
    }

    {
        posts.length > limit && (
            <div class="text-right mt-6">
                <a
                    href="/blog"
                    class="inline-block px-5 py-2 text-sm font-medium no-underline text-theme-accent rounded-md hover:bg-theme-accent hover:text-white transition-colors duration-200 ease-in-out border border-theme-accent hover:border-transparent"
                >
                    View All Articles â†’
                </a>
            </div>
        )
    }
</div>

<style>
    /* Keep only for line clamping if @tailwindcss/line-clamp is not used */
    /* Ensure this is scoped if possible or defined globally if needed */
    :global(.article-description) {
        /* Scoping with :global if this style is unique here and not intended globally */
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
