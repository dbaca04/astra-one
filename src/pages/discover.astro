---
import ContentPage from "../layouts/ContentPage.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import type { CollectionEntry } from "astro:content";
import type { BlogSchema } from "../types";

// Get blog entries for the "discover" section
const allPosts = await getCollection("blog");
// Type assertion for the schema
interface BlogPost extends CollectionEntry<"blog"> {
    data: BlogSchema;
    slug: string;
}
// Filter by section and cast
const discoverPosts = allPosts
    .filter((post) => {
        const data = post.data as BlogSchema;
        return data.section === "discover";
    })
    .sort(
        (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
    ) as BlogPost[];
---

<ContentPage
    title="Discover"
    description="Explore new tools, technologies, and ideas for your next project."
>
    <h2>Welcome to the Discovery Hub</h2>

    <p>
        This section is dedicated to helping you discover new tools,
        technologies, and ideas that can elevate your projects and expand your
        technical horizons.
    </p>

    <p>
        Here you'll find curated resources, emerging technologies, and insights
        that will inspire your next creation. Check back regularly for updated
        content and new discoveries.
    </p>

    <h3>What You'll Find Here</h3>
    <ul>
        <li>Trending technologies and frameworks</li>
        <li>Innovative tools for developers and creators</li>
        <li>Emerging AI capabilities and applications</li>
        <li>New programming languages and paradigms</li>
        <li>Recommended resources and learning paths</li>
    </ul>

    <p>
        Have a suggestion for something we should feature?
        <a href="/contact">Contact us</a> with your recommendations!
    </p>

    <h3>Latest Discover Articles</h3>
    {
        discoverPosts.length > 0 ? (
            <ul class="post-list">
                {discoverPosts.map((post) => (
                    <li class="post-item">
                        <a href={`/blog/${post.slug}`}>
                            <h4>{post.data.title}</h4>
                            <p class="post-date">
                                <FormattedDate date={post.data.pubDate} />
                            </p>
                            <p class="post-description">
                                {post.data.description}
                            </p>
                        </a>
                    </li>
                ))}
            </ul>
        ) : (
            <p>No discover articles yet. Check back soon!</p>
        )
    }

    <style>
        .post-list {
            list-style-type: none;
            padding: 0;
            margin: 2rem 0;
        }
        .post-item {
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        .post-item a {
            text-decoration: none;
            color: inherit;
            display: block;
        }
        .post-item a:hover h4 {
            color: var(--accent);
        }
        .post-date {
            font-size: 0.9rem;
            color: #666;
            margin: 0.25rem 0;
        }
        .post-description {
            margin-top: 0.5rem;
        }
    </style>
</ContentPage>
